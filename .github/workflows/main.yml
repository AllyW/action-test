on: 
  workflow_dispatch:
  pull_request_target:
      types: [opened, labeled, unlabeled, synchronize]

permissions:
  pull-requests: write

jobs:
  checkout-test:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Python 3.10
        uses: actions/setup-python@v3
        with:
           python-version: "3.10"
      - name: Checkout repo
        uses: actions/checkout@v2
        with:
          fetch-depth: 0 # checkout all branches
          ref: ${{github.event.pull_request.head.ref}}
          repository: ${{github.event.pull_request.head.repo.full_name}}
      - name: Show workdirectory after site cloned
        run: |
           pwd
           ls
      - name: Get Diff Files
        run: |
            echo github.event.pull_request.base.sha: ${{github.event.pull_request.base.sha}}
            echo github.event.pull_request.base.ref: ${{ github.event.pull_request.base.ref }}
            echo github.event.pull_request.head.sha: ${{ github.event.pull_request.head.sha }}
            echo github.event.pull_request.head.ref: ${{ github.event.pull_request.head.ref }}
            github.event.pull_request.head.repo.full_name: ${{ github.event.pull_request.head.repo.full_name }}
            echo github.sha: ${{github.sha}}
            echo GITHUB_BASE_REF: ${GITHUB_BASE_REF}
            echo GITHUB_HEAD_REF: ${GITHUB_HEAD_REF}
            echo GITHUB_SHA: ${GITHUB_SHA}
            echo GITHUB_REF: ${GITHUB_REF}
            echo "base_branch=${GITHUB_BASE_REF}" >> $GITHUB_ENV
            echo "diff_branch=${GITHUB_HEAD_REF}" >> $GITHUB_ENV
            echo "base_commit=${GITHUB_SHA}" >> $GITHUB_ENV
            echo "diff_commit=${GITHUB_SHA}" >> $GITHUB_ENV
            git --version
            git log --oneline | head -n 30
            echo git branch -a
            git branch -a
            git diff --name-only --diff-filter=ACMRT ${{ GITHUB_BASE_REF }} ${{ GITHUB_HEAD_REF }} > changed_files
            cat changed_files
